# Sim Studio Camera Auto-Fit Spec

이 문서는 `sim-studio`의 시뮬레이션 캔버스 카메라가 맵/유닛 배치에 맞춰
자동으로 줌 인/아웃 및 패닝을 수행하는 규칙을 정의합니다.

## 목표

- 포커스 대상 유닛들이 항상 한 화면 안에 들어오도록 자동 프레이밍합니다.
- 맵 크기가 달라지더라도 일관된 카메라 스케일 동작을 보장합니다.
- 수동 조작(휠 줌/드래그 팬)을 존중하고, 자동 포커스와 충돌하지 않게 합니다.

## 용어

- 월드 좌표: 시뮬레이션 데이터가 사용하는 실제 좌표계 (`WORLD_WIDTH`, `WORLD_HEIGHT`).
- 캔버스 좌표: 화면에 그려지는 픽셀 좌표.
- baseScale: 월드를 캔버스에 등비로 맞추기 위한 기본 스케일.
- zoom: baseScale에 추가로 곱해지는 사용자/자동 줌 배율.

## 카메라 포커스 모드

카메라는 아래 모드 중 하나를 사용합니다. 기본값은 `auto`입니다.

- `auto`: 선택 유닛이 있으면 선택 유닛, 없으면 살아있는 전체 유닛, 그것도 없으면 전체 유닛.
- `selected`: 선택된 유닛만 포커스. 선택이 없으면 전체 유닛으로 폴백.
- `all-living`: 살아있는 유닛 전체.
- `friendly`: 아군 유닛(생존 우선, 없으면 전체 아군). 아군이 없으면 전체 유닛으로 폴백.
- `enemy`: 적군 유닛(생존 우선, 없으면 전체 적군). 적군이 없으면 전체 유닛으로 폴백.
- `all`: 전체 유닛.

### UI 노출

- Simulation Controls 패널에 `Camera Focus` 드롭다운으로 제공됩니다.

## 프레이밍 규칙

- 포커스 대상들의 최소 경계 박스를 계산합니다. (유닛 반지름 포함)
- 프레이밍 패딩을 월드 단위로 추가합니다. (`AUTO_FIT_PADDING`)
- 너무 과도한 확대를 막기 위해 최소 크기를 보장합니다. (`AUTO_FIT_MIN_SIZE`)
- 캔버스에 완전히 들어오도록 줌 값을 계산합니다.
  - `desiredScale = min(canvasWidth / focusWidth, canvasHeight / focusHeight)`
  - `zoom = clamp(desiredScale / baseScale, MIN_ZOOM, MAX_ZOOM)`
- 포커스 박스 중심이 캔버스 중심에 오도록 팬 값을 계산합니다.

## 수동 조작 우선 규칙

- 사용자가 휠 줌 또는 드래그 팬을 수행하면 일정 시간 동안 자동 프레이밍을 중단합니다.
- 중단 시간(`AUTO_FIT_COOLDOWN_MS`) 이후 자동 프레이밍이 다시 활성화됩니다.
- 선택 유닛이 변경되면 자동 프레이밍을 즉시 재평가합니다.

## 기본 파라미터

- `AUTO_FIT_PADDING`: 60 (월드 단위)
- `AUTO_FIT_MIN_SIZE`: 200 (월드 단위)
- `AUTO_FIT_COOLDOWN_MS`: 2000ms
- `CAMERA_PAN_SPEED`: 1600 (캔버스 픽셀/초)
- `CAMERA_ZOOM_SPEED`: 1.5 (줌 배율/초)

## 카메라 애니메이션 규칙

- 카메라 이동(패닝)과 줌은 일정 속도로 보간되며, 목표 값에 근접하면 스냅합니다.
- 자동 프레이밍과 수동 조작 모두 동일한 애니메이션 규칙을 사용합니다.

## 향후 확장 포인트

- UI 토글로 자동 프레이밍 On/Off 제어
- 특정 그룹(아군만, 적군만, 전투 중 유닛만 등) 선택 옵션
- 포커스 대상 변경 시 부드러운 보간(lerp) 애니메이션
